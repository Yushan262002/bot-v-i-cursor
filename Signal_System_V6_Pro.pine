// This Pine Scriptâ„¢ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// Â© traderschatroom88 - Enhanced Signal System V6 Pro

//@version=5
indicator('Signal System V6 Pro - Enhanced', shorttitle='Signal V6 Pro', overlay=true, max_labels_count=500, max_lines_count=500, max_boxes_count=500)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“Š SIGNAL SYSTEM SETTINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

group_signal = "ğŸ¯ Signal System"
sensitivity = input.float(5, title='Signal Sensitivity', step=.5, group=group_signal, tooltip="Lower = more sensitive, more signals\nHigher = less sensitive, fewer signals")
volatility_period = input.int(10, title='Volatility Period (ATR)', group=group_signal)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ›¡ï¸ TREND FILTER SETTINGS - Kháº¯c phá»¥c: "KhÃ´ng cÃ³ bá»™ lá»c trend"
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

group_trend = "ğŸ›¡ï¸ Trend Filter (Anti-Whipsaw)"
enable_trend_filter = input.bool(true, title='Enable Trend Filter', group=group_trend, tooltip="Filter signals to trade with the trend only")
trend_filter_type = input.string('EMA', title='Trend Filter Type', options=['EMA', 'Supertrend', 'Both'], group=group_trend)

// EMA Trend Filter
ema_length = input.int(50, title='EMA Length', group=group_trend)
ema_trend = ta.ema(close, ema_length)

// Supertrend Filter
supertrend_period = input.int(10, title='Supertrend Period', group=group_trend)
supertrend_multiplier = input.float(3.0, title='Supertrend Multiplier', group=group_trend)

[supertrend, direction] = ta.supertrend(supertrend_multiplier, supertrend_period)
is_uptrend_super = direction < 0
is_downtrend_super = direction > 0

// Combined Trend Logic
is_uptrend_ema = close > ema_trend
is_downtrend_ema = close < ema_trend

is_uptrend = trend_filter_type == 'EMA' ? is_uptrend_ema : 
             trend_filter_type == 'Supertrend' ? is_uptrend_super : 
             is_uptrend_ema and is_uptrend_super

is_downtrend = trend_filter_type == 'EMA' ? is_downtrend_ema : 
               trend_filter_type == 'Supertrend' ? is_downtrend_super : 
               is_downtrend_ema and is_downtrend_super

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“‰ ADX FILTER - Kháº¯c phá»¥c: "TÃ­n hiá»‡u muá»™n trong sideway"
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

group_adx = "ğŸ“‰ ADX Filter (Avoid Sideway)"
enable_adx_filter = input.bool(true, title='Enable ADX Filter', group=group_adx, tooltip="Only trade when trend strength is sufficient")
adx_length = input.int(14, title='ADX Length', group=group_adx)
adx_threshold = input.float(20, title='ADX Threshold', group=group_adx, tooltip="ADX > threshold = trending market\nADX < threshold = ranging market (avoid)")

// ADX Calculation
[diPlus, diMinus, adx] = ta.dmi(adx_length, adx_length)
is_trending = adx > adx_threshold
is_strong_trend = adx > adx_threshold * 1.5

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸŒŠ VOLATILITY FILTER - Kháº¯c phá»¥c: "Whipsaw trong biáº¿n Ä‘á»™ng cao"
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

group_vol = "ğŸŒŠ Volatility Filter"
enable_volatility_filter = input.bool(true, title='Enable Volatility Filter', group=group_vol, tooltip="Avoid extreme volatility periods")
volatility_threshold_low = input.float(0.5, title='Min Volatility (ATR multiplier)', group=group_vol, tooltip="Skip signals if volatility too low")
volatility_threshold_high = input.float(3.0, title='Max Volatility (ATR multiplier)', group=group_vol, tooltip="Skip signals if volatility too high (whipsaw risk)")

// Volatility Calculation
atr = ta.atr(volatility_period)
atr_ma = ta.sma(atr, 20)
volatility_ratio = atr / atr_ma

is_normal_volatility = volatility_ratio >= volatility_threshold_low and volatility_ratio <= volatility_threshold_high

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ’° RISK MANAGEMENT - Kháº¯c phá»¥c: "Risk/Reward khÃ´ng rÃµ rÃ ng"
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

group_risk = "ğŸ’° Risk Management"
show_risk_levels = input.bool(true, title='Show Stop Loss & Take Profit', group=group_risk)
stop_loss_atr = input.float(2.0, title='Stop Loss (ATR multiplier)', group=group_risk, tooltip="Stop Loss distance from entry")
take_profit_atr = input.float(4.0, title='Take Profit (ATR multiplier)', group=group_risk, tooltip="Take Profit distance from entry\nDefault 2:1 Risk/Reward")
use_trailing_stop = input.bool(true, title='Use Trailing Stop', group=group_risk)
trailing_activation_atr = input.float(2.0, title='Trailing Activation (ATR)', group=group_risk, tooltip="Start trailing after this profit")
trailing_distance_atr = input.float(1.5, title='Trailing Distance (ATR)', group=group_risk)

// Risk/Reward Ratio
risk_reward_ratio = take_profit_atr / stop_loss_atr

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ¨ VISUAL SETTINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

group_visual = "ğŸ¨ Visual Settings"
show_signals = input.bool(true, title='Show Entry Signals', group=group_visual)
show_signal_line = input.bool(true, title='Show Signal Line', group=group_visual)
show_trend_filter_line = input.bool(true, title='Show Trend Filter Line', group=group_visual)
show_dashboard = input.bool(true, title='Show Info Dashboard', group=group_visual)

color_long = input.color(#00ff00, title='Long Color', group=group_visual, inline='col1')
color_short = input.color(#ff0000, title='Short Color', group=group_visual, inline='col1')
color_signal_line = input.color(#2962FF, title='Signal Line Color', group=group_visual, inline='col2')
color_trend_line = input.color(#FF6D00, title='Trend Line Color', group=group_visual, inline='col2')

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ”§ CORE SIGNAL CALCULATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

src = close
xATR = ta.atr(volatility_period)
nLoss = sensitivity * xATR

// Signal Line Calculation (Trailing Stop Logic)
xSignalLine = 0.0
iff_1 = src > nz(xSignalLine[1], 0) ? src - nLoss : src + nLoss
iff_2 = src < nz(xSignalLine[1], 0) and src[1] < nz(xSignalLine[1], 0) ? math.min(nz(xSignalLine[1]), src + nLoss) : iff_1
xSignalLine := src > nz(xSignalLine[1], 0) and src[1] > nz(xSignalLine[1], 0) ? math.max(nz(xSignalLine[1]), src - nLoss) : iff_2

// Position Detection
pos = 0
iff_3 = src[1] > nz(xSignalLine[1], 0) and src < nz(xSignalLine[1], 0) ? -1 : nz(pos[1], 0)
pos := src[1] < nz(xSignalLine[1], 0) and src > nz(xSignalLine[1], 0) ? 1 : iff_3

// Basic Crossover Signals
basic_long_signal = ta.crossover(src, xSignalLine)
basic_short_signal = ta.crossunder(src, xSignalLine)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âœ… FILTERED SIGNALS (vá»›i táº¥t cáº£ bá»™ lá»c)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Trend Filter Check
trend_ok_long = enable_trend_filter ? is_uptrend : true
trend_ok_short = enable_trend_filter ? is_downtrend : true

// ADX Filter Check
adx_ok = enable_adx_filter ? is_trending : true

// Volatility Filter Check
vol_ok = enable_volatility_filter ? is_normal_volatility : true

// Final Filtered Signals
long_signal = basic_long_signal and trend_ok_long and adx_ok and vol_ok
short_signal = basic_short_signal and trend_ok_short and adx_ok and vol_ok

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“ STOP LOSS & TAKE PROFIT CALCULATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var float entry_price = na
var float stop_loss = na
var float take_profit = na
var float trailing_stop = na
var bool in_long_position = false
var bool in_short_position = false
var int bars_in_trade = 0

// Entry Logic
if long_signal
    entry_price := close
    stop_loss := entry_price - (atr * stop_loss_atr)
    take_profit := entry_price + (atr * take_profit_atr)
    trailing_stop := na
    in_long_position := true
    in_short_position := false
    bars_in_trade := 0

if short_signal
    entry_price := close
    stop_loss := entry_price + (atr * stop_loss_atr)
    take_profit := entry_price - (atr * take_profit_atr)
    trailing_stop := na
    in_short_position := true
    in_long_position := false
    bars_in_trade := 0

// Trailing Stop Logic for Long
if in_long_position
    bars_in_trade += 1
    profit = close - entry_price
    
    // Activate trailing stop when profit threshold reached
    if use_trailing_stop and profit >= (atr * trailing_activation_atr)
        new_trailing = close - (atr * trailing_distance_atr)
        trailing_stop := na(trailing_stop) ? new_trailing : math.max(trailing_stop, new_trailing)
    
    // Exit conditions
    hit_stop = close <= (use_trailing_stop and not na(trailing_stop) ? trailing_stop : stop_loss)
    hit_target = close >= take_profit
    
    if hit_stop or hit_target
        in_long_position := false
        entry_price := na
        stop_loss := na
        take_profit := na
        trailing_stop := na

// Trailing Stop Logic for Short
if in_short_position
    bars_in_trade += 1
    profit = entry_price - close
    
    // Activate trailing stop when profit threshold reached
    if use_trailing_stop and profit >= (atr * trailing_activation_atr)
        new_trailing = close + (atr * trailing_distance_atr)
        trailing_stop := na(trailing_stop) ? new_trailing : math.min(trailing_stop, new_trailing)
    
    // Exit conditions
    hit_stop = close >= (use_trailing_stop and not na(trailing_stop) ? trailing_stop : stop_loss)
    hit_target = close <= take_profit
    
    if hit_stop or hit_target
        in_short_position := false
        entry_price := na
        stop_loss := na
        take_profit := na
        trailing_stop := na

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ¨ PLOTTING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Signal Line
plot(show_signal_line ? xSignalLine : na, 'Signal Line', color=color_signal_line, linewidth=2, style=plot.style_line)

// Trend Filter Line
plot(show_trend_filter_line and enable_trend_filter and trend_filter_type != 'Supertrend' ? ema_trend : na, 
     'EMA Trend', color=color_trend_line, linewidth=2, style=plot.style_line)
plot(show_trend_filter_line and enable_trend_filter and trend_filter_type == 'Supertrend' ? supertrend : na, 
     'Supertrend', color=direction < 0 ? #00ff00 : #ff0000, linewidth=2, style=plot.style_line)

// Entry Signals
plotshape(show_signals and long_signal, title='Long Entry', text='LONG\nâ¬†', 
          style=shape.labelup, location=location.belowbar, 
          color=color_long, textcolor=color.white, size=size.normal)

plotshape(show_signals and short_signal, title='Short Entry', text='SHORT\nâ¬‡', 
          style=shape.labeldown, location=location.abovebar, 
          color=color_short, textcolor=color.white, size=size.normal)

// Stop Loss & Take Profit Lines
var line sl_line = na
var line tp_line = na
var line ts_line = na

if show_risk_levels
    // Delete old lines
    if not na(sl_line)
        line.delete(sl_line)
    if not na(tp_line)
        line.delete(tp_line)
    if not na(ts_line)
        line.delete(ts_line)
    
    // Draw new lines for active positions
    if in_long_position or in_short_position
        current_sl = use_trailing_stop and not na(trailing_stop) ? trailing_stop : stop_loss
        
        sl_line := line.new(bar_index - bars_in_trade, current_sl, bar_index + 10, current_sl, 
                           color=color_short, width=2, style=line.style_dashed, 
                           extend=extend.none)
        
        tp_line := line.new(bar_index - bars_in_trade, take_profit, bar_index + 10, take_profit, 
                           color=color_long, width=2, style=line.style_dashed, 
                           extend=extend.none)
        
        // Show trailing stop separately if active
        if use_trailing_stop and not na(trailing_stop)
            ts_line := line.new(bar_index - bars_in_trade, trailing_stop, bar_index + 10, trailing_stop, 
                               color=color.orange, width=2, style=line.style_dotted, 
                               extend=extend.none)

// Labels for SL/TP
var label sl_label = na
var label tp_label = na
var label entry_label = na

if show_risk_levels and (long_signal or short_signal)
    // Delete old labels
    if not na(sl_label)
        label.delete(sl_label)
    if not na(tp_label)
        label.delete(tp_label)
    if not na(entry_label)
        label.delete(entry_label)
    
    // Create new labels
    if long_signal
        entry_label := label.new(bar_index, entry_price, 
                               text='Entry: ' + str.tostring(entry_price, format.mintick), 
                               color=color.new(color_long, 80), textcolor=color.white, 
                               style=label.style_label_left, size=size.small)
        
        sl_label := label.new(bar_index, stop_loss, 
                            text='SL: ' + str.tostring(stop_loss, format.mintick), 
                            color=color.new(color_short, 80), textcolor=color.white, 
                            style=label.style_label_left, size=size.small)
        
        tp_label := label.new(bar_index, take_profit, 
                            text='TP: ' + str.tostring(take_profit, format.mintick) + ' (RR:' + str.tostring(risk_reward_ratio, '#.#') + ')', 
                            color=color.new(color_long, 80), textcolor=color.white, 
                            style=label.style_label_left, size=size.small)
    
    if short_signal
        entry_label := label.new(bar_index, entry_price, 
                               text='Entry: ' + str.tostring(entry_price, format.mintick), 
                               color=color.new(color_short, 80), textcolor=color.white, 
                               style=label.style_label_left, size=size.small)
        
        sl_label := label.new(bar_index, stop_loss, 
                            text='SL: ' + str.tostring(stop_loss, format.mintick), 
                            color=color.new(color_short, 80), textcolor=color.white, 
                            style=label.style_label_left, size=size.small)
        
        tp_label := label.new(bar_index, take_profit, 
                            text='TP: ' + str.tostring(take_profit, format.mintick) + ' (RR:' + str.tostring(risk_reward_ratio, '#.#') + ')', 
                            color=color.new(color_long, 80), textcolor=color.white, 
                            style=label.style_label_left, size=size.small)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“Š DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var table dashboard = table.new(position.top_right, 2, 10, border_width=2, 
                                border_color=color.gray, frame_color=color.gray, frame_width=2)

if show_dashboard and barstate.islast
    // Header
    table.cell(dashboard, 0, 0, 'Signal System V6 Pro', bgcolor=#1a1a2e, text_color=color.white, 
              text_size=size.normal, text_halign=text.align_center)
    table.merge_cells(dashboard, 0, 0, 1, 0)
    
    // Market Status
    trend_text = is_uptrend ? 'ğŸŸ¢ UPTREND' : is_downtrend ? 'ğŸ”´ DOWNTREND' : 'âšª SIDEWAYS'
    trend_color = is_uptrend ? color.new(color_long, 70) : is_downtrend ? color.new(color_short, 70) : color.new(color.gray, 70)
    
    table.cell(dashboard, 0, 1, 'Market Status:', bgcolor=#2e2e42, text_color=color.white, text_size=size.small)
    table.cell(dashboard, 1, 1, trend_text, bgcolor=trend_color, text_color=color.white, text_size=size.small)
    
    // ADX
    adx_status = adx > adx_threshold * 1.5 ? 'ğŸ”¥ STRONG' : adx > adx_threshold ? 'âœ… TRENDING' : 'âš ï¸ WEAK'
    adx_color = adx > adx_threshold * 1.5 ? color.new(color_long, 70) : adx > adx_threshold ? color.new(color.orange, 70) : color.new(color.gray, 70)
    
    table.cell(dashboard, 0, 2, 'ADX (' + str.tostring(math.round(adx, 1)) + '):', 
              bgcolor=#2e2e42, text_color=color.white, text_size=size.small)
    table.cell(dashboard, 1, 2, adx_status, bgcolor=adx_color, text_color=color.white, text_size=size.small)
    
    // Volatility
    vol_status = volatility_ratio > 2 ? 'âš ï¸ HIGH' : volatility_ratio > 0.5 ? 'âœ… NORMAL' : 'ğŸ“‰ LOW'
    vol_color = volatility_ratio > 2 ? color.new(color_short, 70) : volatility_ratio > 0.5 ? color.new(color_long, 70) : color.new(color.gray, 70)
    
    table.cell(dashboard, 0, 3, 'Volatility:', bgcolor=#2e2e42, text_color=color.white, text_size=size.small)
    table.cell(dashboard, 1, 3, vol_status, bgcolor=vol_color, text_color=color.white, text_size=size.small)
    
    // Signal Status
    signal_text = long_signal ? 'ğŸš€ LONG SIGNAL!' : short_signal ? 'ğŸ“‰ SHORT SIGNAL!' : in_long_position ? 'ğŸ“ˆ In Long' : in_short_position ? 'ğŸ“‰ In Short' : 'â¸ï¸ No Signal'
    signal_color = long_signal or in_long_position ? color.new(color_long, 50) : short_signal or in_short_position ? color.new(color_short, 50) : color.new(color.gray, 70)
    
    table.cell(dashboard, 0, 4, 'Status:', bgcolor=#2e2e42, text_color=color.white, text_size=size.small)
    table.cell(dashboard, 1, 4, signal_text, bgcolor=signal_color, text_color=color.white, text_size=size.small)
    
    // Position Info (if in trade)
    if in_long_position or in_short_position
        current_pnl = in_long_position ? (close - entry_price) : (entry_price - close)
        pnl_percent = (current_pnl / entry_price) * 100
        pnl_text = str.tostring(pnl_percent, '#.##') + '%'
        pnl_color = current_pnl > 0 ? color.new(color_long, 50) : color.new(color_short, 50)
        
        table.cell(dashboard, 0, 5, 'P&L:', bgcolor=#2e2e42, text_color=color.white, text_size=size.small)
        table.cell(dashboard, 1, 5, pnl_text, bgcolor=pnl_color, text_color=color.white, text_size=size.small)
        
        // Risk/Reward
        table.cell(dashboard, 0, 6, 'Risk/Reward:', bgcolor=#2e2e42, text_color=color.white, text_size=size.small)
        table.cell(dashboard, 1, 6, '1:' + str.tostring(risk_reward_ratio, '#.#'), 
                  bgcolor=color.new(color.blue, 70), text_color=color.white, text_size=size.small)
        
        // Trailing Status
        if use_trailing_stop
            trailing_status = not na(trailing_stop) ? 'âœ… ACTIVE' : 'â³ Waiting'
            trailing_color = not na(trailing_stop) ? color.new(color_long, 70) : color.new(color.gray, 70)
            
            table.cell(dashboard, 0, 7, 'Trailing Stop:', bgcolor=#2e2e42, text_color=color.white, text_size=size.small)
            table.cell(dashboard, 1, 7, trailing_status, bgcolor=trailing_color, text_color=color.white, text_size=size.small)
    else
        // Filters Status
        table.cell(dashboard, 0, 5, 'Trend Filter:', bgcolor=#2e2e42, text_color=color.white, text_size=size.small)
        table.cell(dashboard, 1, 5, trend_ok_long or trend_ok_short ? 'âœ… OK' : 'âŒ NO', 
                  bgcolor=trend_ok_long or trend_ok_short ? color.new(color_long, 70) : color.new(color_short, 70), 
                  text_color=color.white, text_size=size.small)
        
        table.cell(dashboard, 0, 6, 'ADX Filter:', bgcolor=#2e2e42, text_color=color.white, text_size=size.small)
        table.cell(dashboard, 1, 6, adx_ok ? 'âœ… OK' : 'âŒ NO', 
                  bgcolor=adx_ok ? color.new(color_long, 70) : color.new(color_short, 70), 
                  text_color=color.white, text_size=size.small)
        
        table.cell(dashboard, 0, 7, 'Vol Filter:', bgcolor=#2e2e42, text_color=color.white, text_size=size.small)
        table.cell(dashboard, 1, 7, vol_ok ? 'âœ… OK' : 'âŒ NO', 
                  bgcolor=vol_ok ? color.new(color_long, 70) : color.new(color_short, 70), 
                  text_color=color.white, text_size=size.small)
    
    // ATR Info
    table.cell(dashboard, 0, 8, 'ATR:', bgcolor=#2e2e42, text_color=color.white, text_size=size.small)
    table.cell(dashboard, 1, 8, str.tostring(atr, format.mintick), 
              bgcolor=color.new(color.blue, 70), text_color=color.white, text_size=size.small)
    
    // Settings Summary
    filters_count = (enable_trend_filter ? 1 : 0) + (enable_adx_filter ? 1 : 0) + (enable_volatility_filter ? 1 : 0)
    table.cell(dashboard, 0, 9, 'Active Filters:', bgcolor=#2e2e42, text_color=color.white, text_size=size.small)
    table.cell(dashboard, 1, 9, str.tostring(filters_count) + '/3', 
              bgcolor=color.new(color.purple, 70), text_color=color.white, text_size=size.small)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ”” ALERTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alertcondition(long_signal, 
              title='ğŸš€ Long Signal', 
              message='ğŸš€ LONG SIGNAL on {{ticker}}\n' + 
                      'Price: {{close}}\n' + 
                      'Stop Loss: ' + str.tostring(stop_loss, format.mintick) + '\n' + 
                      'Take Profit: ' + str.tostring(take_profit, format.mintick) + '\n' + 
                      'Risk/Reward: 1:' + str.tostring(risk_reward_ratio, '#.#'))

alertcondition(short_signal, 
              title='ğŸ“‰ Short Signal', 
              message='ğŸ“‰ SHORT SIGNAL on {{ticker}}\n' + 
                      'Price: {{close}}\n' + 
                      'Stop Loss: ' + str.tostring(stop_loss, format.mintick) + '\n' + 
                      'Take Profit: ' + str.tostring(take_profit, format.mintick) + '\n' + 
                      'Risk/Reward: 1:' + str.tostring(risk_reward_ratio, '#.#'))

// Stop Loss Hit
alertcondition(in_long_position and close <= stop_loss, 
              title='ğŸ›‘ Long Stop Loss Hit', 
              message='ğŸ›‘ Long Stop Loss Hit on {{ticker}}\nExit Price: {{close}}')

alertcondition(in_short_position and close >= stop_loss, 
              title='ğŸ›‘ Short Stop Loss Hit', 
              message='ğŸ›‘ Short Stop Loss Hit on {{ticker}}\nExit Price: {{close}}')

// Take Profit Hit
alertcondition(in_long_position and close >= take_profit, 
              title='ğŸ¯ Long Take Profit Hit', 
              message='ğŸ¯ Long Take Profit Hit on {{ticker}}\nExit Price: {{close}}')

alertcondition(in_short_position and close <= take_profit, 
              title='ğŸ¯ Short Take Profit Hit', 
              message='ğŸ¯ Short Take Profit Hit on {{ticker}}\nExit Price: {{close}}')

// Trailing Stop Activated
alertcondition(use_trailing_stop and in_long_position and not na(trailing_stop) and na(trailing_stop[1]), 
              title='ğŸ”„ Long Trailing Stop Activated', 
              message='ğŸ”„ Long Trailing Stop Activated on {{ticker}}\nTrailing at: ' + str.tostring(trailing_stop, format.mintick))

alertcondition(use_trailing_stop and in_short_position and not na(trailing_stop) and na(trailing_stop[1]), 
              title='ğŸ”„ Short Trailing Stop Activated', 
              message='ğŸ”„ Short Trailing Stop Activated on {{ticker}}\nTrailing at: ' + str.tostring(trailing_stop, format.mintick))

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“ COMMENTS & DOCUMENTATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“š HÆ¯á»šNG DáºªN Sá»¬ Dá»¤NG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//
// 1. CÃ€I Äáº¶T CÆ  Báº¢N:
//    - Signal Sensitivity: 5 (default) - Giáº£m Ä‘á»ƒ nhiá»u tÃ­n hiá»‡u, tÄƒng Ä‘á»ƒ Ã­t tÃ­n hiá»‡u
//    - Volatility Period: 10 (default)
//
// 2. Bá»˜ Lá»ŒC TREND:
//    - Báº­t "Enable Trend Filter" Ä‘á»ƒ chá»‰ giao dá»‹ch theo xu hÆ°á»›ng
//    - Chá»n EMA (nhanh), Supertrend (chÃ­nh xÃ¡c hÆ¡n), hoáº·c Both (an toÃ n nháº¥t)
//
// 3. Bá»˜ Lá»ŒC ADX:
//    - Báº­t Ä‘á»ƒ trÃ¡nh giao dá»‹ch trong thá»‹ trÆ°á»ng sideway
//    - ADX Threshold: 20 (default) - TÄƒng lÃªn náº¿u muá»‘n chá»‰ trade trend máº¡nh
//
// 4. Bá»˜ Lá»ŒC VOLATILITY:
//    - TrÃ¡nh whipsaw khi volatility quÃ¡ cao (> 3.0)
//    - TrÃ¡nh tÃ­n hiá»‡u khi volatility quÃ¡ tháº¥p (< 0.5)
//
// 5. QUáº¢N LÃ Rá»¦I RO:
//    - Stop Loss: 2 ATR (default)
//    - Take Profit: 4 ATR (default) = Risk/Reward 1:2
//    - Trailing Stop: Tá»± Ä‘á»™ng báº£o vá»‡ lá»£i nhuáº­n sau khi Ä‘áº¡t 2 ATR profit
//
// 6. CÃCH Äá»ŒC DASHBOARD:
//    - Market Status: Trend hiá»‡n táº¡i (Uptrend/Downtrend/Sideways)
//    - ADX: Äá»™ máº¡nh cá»§a trend (Strong/Trending/Weak)
//    - Volatility: Má»©c Ä‘á»™ biáº¿n Ä‘á»™ng (High/Normal/Low)
//    - Status: Tráº¡ng thÃ¡i tÃ­n hiá»‡u hiá»‡n táº¡i
//    - P&L: LÃ£i/lá»— cá»§a lá»‡nh Ä‘ang má»Ÿ (náº¿u cÃ³)
//    - Trailing Stop: Tráº¡ng thÃ¡i trailing stop
//
// 7. ALERTS:
//    - Thiáº¿t láº­p alert cho "Long Signal" vÃ  "Short Signal"
//    - Alert sáº½ bao gá»“m Entry, SL, TP vÃ  Risk/Reward ratio
//
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âœ… Cáº¢I TIáº¾N SO Vá»šI PHIÃŠN Báº¢N Gá»C
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//
// âŒ Váº¤N Äá»€ 1: "TÃ­n hiá»‡u muá»™n trong sideway"
// âœ… GIáº¢I PHÃP: ADX Filter - Chá»‰ trade khi ADX > threshold (trending market)
//
// âŒ Váº¤N Äá»€ 2: "Whipsaw trong biáº¿n Ä‘á»™ng cao"
// âœ… GIáº¢I PHÃP: Volatility Filter - TrÃ¡nh trade khi ATR ratio quÃ¡ cao/tháº¥p
//
// âŒ Váº¤N Äá»€ 3: "KhÃ´ng cÃ³ bá»™ lá»c trend"
// âœ… GIáº¢I PHÃP: Trend Filter vá»›i 3 options (EMA/Supertrend/Both)
//
// âŒ Váº¤N Äá»€ 4: "Risk/Reward khÃ´ng rÃµ rÃ ng"
// âœ… GIáº¢I PHÃP: 
//    - ATR-based Stop Loss & Take Profit tá»± Ä‘á»™ng
//    - Hiá»ƒn thá»‹ trá»±c quan trÃªn chart
//    - Risk/Reward ratio cÃ³ thá»ƒ tÃ¹y chá»‰nh
//    - Trailing Stop Ä‘á»ƒ báº£o vá»‡ lá»£i nhuáº­n
//    - Dashboard hiá»ƒn thá»‹ Ä‘áº§y Ä‘á»§ thÃ´ng tin
//
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ¯ KHUYáº¾N NGHá»Š TRADING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//
// ğŸ“ˆ CHO TRENDING MARKET:
//    - Enable all filters
//    - ADX threshold: 20-25
//    - Trend Filter: Both (EMA + Supertrend)
//
// ğŸ“Š CHO VOLATILE MARKET:
//    - TÄƒng Sensitivity lÃªn 6-7
//    - TÄƒng Stop Loss lÃªn 2.5-3 ATR
//    - Max Volatility: 2.5
//
// ğŸ’¤ CHO RANGING MARKET:
//    - Disable Trend Filter
//    - ADX threshold: 15
//    - Giáº£m Take Profit xuá»‘ng 3 ATR
//
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
